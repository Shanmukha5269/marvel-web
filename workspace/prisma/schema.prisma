generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Scope {
  NONE
  PROFILE
  WRITER
  R_WRITER
  CRDN
  ADMIN
}

type Level {
  tasks Task[]
}

type Task {
  description String
}

enum TypeOfWork {
  COURSE
  PROJECT
}

enum ReviewStatus {
  PENDING
  APPROVED
  FLAGGED
  FEATURED
}

enum TypeOfArticle {
  BLOG
  RESOURCE
}

model People {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  slug         String?  @unique
  name         String
  email        String   @unique
  profilePic   String
  googleId     String   @unique
  scope        Scope[]  @default([NONE])
  crdnCourses  String[] @default([])
  readMe       String?
  rankingScore Int      @default(1)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@map("people")
}

model Course {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  courseCode     String   @unique
  courseDuration String
  caption        String
  totalLevels    Int
  intro          String
  levels         Level[]
  rankingScore   Int      @default(1)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("courses")
}

enum Role {
  ACTIVE
  INACTIVE
  WRITER
}

type Person {
  googleId   String
  name       String
  slug       String
  profilePic String
  role       Role?
}

model Work {
  id           String     @id @default(auto()) @map("_id") @db.ObjectId
  typeOfWork   TypeOfWork @map("_type")
  //people part of this work
  authors      Person[]
  //coordinators for this work
  coordinators Person[]
  //reports
  Report       Report[]

  name         String?
  coverPhoto   String?
  level        Int      @default(1) //is also used as stage number
  totalLevels  Int?
  courseCode   String?
  note         String?
  searchTerms  String[] @default([])
  rankingScore Int      @default(1)

  @@map("works")
}

model Report {
  id     String @id @default(auto()) @map("_id") @db.ObjectId
  work   Work   @relation(fields: [workId], references: [id])
  workId String @db.ObjectId
  level  Int //is also used as stage number

  title   String
  content String

  reviewStatus ReviewStatus @default(PENDING)
  feedback     String?

  @@map("reports")
}

model Article {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  typeOfArticle TypeOfArticle @map("_type")
  author        Person

  title        String
  tags         String[]     @default([])
  coverPhoto   String?
  content      String
  courseCodes  String[]
  reviewStatus ReviewStatus
  searchTerms  String[]     @default([])
  feedback     String?
  rankingScore Int          @default(1)

  @@map("articles")
}
